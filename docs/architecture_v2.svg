<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1100" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <!-- Gradients -->
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="captureGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <linearGradient id="stateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="replayGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb"/>
      <stop offset="100%" style="stop-color:#f5576c"/>
    </linearGradient>
    <linearGradient id="clusterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff9a9e"/>
      <stop offset="100%" style="stop-color:#fecfef"/>
    </linearGradient>
    <linearGradient id="gdbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a18cd1"/>
      <stop offset="100%" style="stop-color:#fbc2eb"/>
    </linearGradient>
    <linearGradient id="formatGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a"/>
      <stop offset="100%" style="stop-color:#fee140"/>
    </linearGradient>
    <linearGradient id="commonGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#89f7fe"/>
      <stop offset="100%" style="stop-color:#66a6ff"/>
    </linearGradient>
    <!-- Shadow filter -->
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="130%">
      <feDropShadow dx="2" dy="4" stdDeviation="4" flood-opacity="0.15"/>
    </filter>
    <filter id="lightShadow" x="-5%" y="-5%" width="110%" height="115%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#fafbfc"/>
  
  <!-- Header -->
  <rect x="40" y="20" width="1320" height="70" rx="12" fill="url(#headerGrad)" filter="url(#shadow)"/>
  <text x="700" y="52" text-anchor="middle" fill="white" font-size="28" font-weight="700">TraceSmith Architecture</text>
  <text x="700" y="75" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-size="14">v0.10.0 | GPU Profiling &amp; Replay System | Cross-Platform</text>

  <!-- Application Layer -->
  <rect x="40" y="110" width="1320" height="80" rx="10" fill="#f8f9fa" stroke="#e9ecef" stroke-width="2"/>
  <text x="60" y="135" fill="#495057" font-size="13" font-weight="600">Application Layer</text>
  
  <rect x="60" y="145" width="140" height="35" rx="6" fill="#4dabf7" filter="url(#lightShadow)"/>
  <text x="130" y="168" text-anchor="middle" fill="white" font-size="12" font-weight="500">C++ Application</text>
  
  <rect x="220" y="145" width="140" height="35" rx="6" fill="#ffd43b" filter="url(#lightShadow)"/>
  <text x="290" y="168" text-anchor="middle" fill="#495057" font-size="12" font-weight="500">Python Application</text>
  
  <rect x="380" y="145" width="130" height="35" rx="6" fill="#4dabf7" filter="url(#lightShadow)"/>
  <text x="445" y="168" text-anchor="middle" fill="white" font-size="12" font-weight="500">C++ CLI</text>
  
  <rect x="530" y="145" width="130" height="35" rx="6" fill="#ffd43b" filter="url(#lightShadow)"/>
  <text x="595" y="168" text-anchor="middle" fill="#495057" font-size="12" font-weight="500">Python CLI</text>
  
  <rect x="680" y="145" width="160" height="35" rx="6" fill="#e599f7" filter="url(#lightShadow)"/>
  <text x="760" y="168" text-anchor="middle" fill="white" font-size="12" font-weight="500">Perfetto UI / Chrome</text>
  
  <rect x="860" y="145" width="150" height="35" rx="6" fill="#a18cd1" filter="url(#lightShadow)"/>
  <text x="935" y="168" text-anchor="middle" fill="white" font-size="12" font-weight="500">GDB Client</text>
  
  <!-- Python Bindings -->
  <rect x="40" y="200" width="1320" height="50" rx="10" fill="#fff3bf" stroke="#ffc078" stroke-width="2"/>
  <text x="60" y="230" fill="#e67700" font-size="13" font-weight="600">Python Bindings (pybind11)</text>
  <rect x="500" y="210" width="400" height="30" rx="6" fill="#ffc078" filter="url(#lightShadow)"/>
  <text x="700" y="232" text-anchor="middle" fill="white" font-size="12" font-weight="500">_tracesmith.so - Native Extension Module</text>

  <!-- Core Library Background -->
  <rect x="40" y="260" width="1320" height="580" rx="12" fill="white" stroke="#dee2e6" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="290" fill="#212529" font-size="16" font-weight="700">TraceSmith Core Library (C++17)</text>

  <!-- Row 1: Capture + State + Replay -->
  
  <!-- Capture Module -->
  <rect x="60" y="310" width="420" height="200" rx="10" fill="url(#captureGrad)" filter="url(#lightShadow)"/>
  <text x="270" y="335" text-anchor="middle" fill="white" font-size="14" font-weight="700">Capture Module</text>
  
  <rect x="75" y="350" width="90" height="50" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="120" y="372" text-anchor="middle" fill="white" font-size="10" font-weight="600">CUPTI</text>
  <text x="120" y="388" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="9">NVIDIA</text>
  
  <rect x="175" y="350" width="90" height="50" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="220" y="372" text-anchor="middle" fill="white" font-size="10" font-weight="600">MCPTI</text>
  <text x="220" y="388" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="9">MetaX</text>
  
  <rect x="275" y="350" width="90" height="50" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="320" y="372" text-anchor="middle" fill="white" font-size="10" font-weight="600">Metal</text>
  <text x="320" y="388" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="9">Apple</text>
  
  <rect x="375" y="350" width="90" height="50" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="420" y="372" text-anchor="middle" fill="white" font-size="10" font-weight="600">Ascend</text>
  <text x="420" y="388" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="9">Huawei</text>
  
  <rect x="75" y="410" width="190" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="170" y="435" text-anchor="middle" fill="white" font-size="10" font-weight="600">MemoryProfiler</text>
  
  <rect x="275" y="410" width="190" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="370" y="435" text-anchor="middle" fill="white" font-size="10" font-weight="600">BPF Tracer (Linux)</text>
  
  <rect x="75" y="460" width="390" height="35" rx="5" fill="rgba(0,0,0,0.15)"/>
  <text x="270" y="483" text-anchor="middle" fill="white" font-size="10" font-weight="500">createProfiler() + IPlatformProfiler Interface</text>

  <!-- State Module -->
  <rect x="500" y="310" width="300" height="200" rx="10" fill="url(#stateGrad)" filter="url(#lightShadow)"/>
  <text x="650" y="335" text-anchor="middle" fill="white" font-size="14" font-weight="700">State Module</text>
  
  <rect x="515" y="350" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="580" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">GPUStateMachine</text>
  
  <rect x="655" y="350" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="720" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">InstructionStream</text>
  
  <rect x="515" y="400" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="580" y="425" text-anchor="middle" fill="white" font-size="10" font-weight="600">TimelineBuilder</text>
  
  <rect x="655" y="400" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="720" y="425" text-anchor="middle" fill="white" font-size="10" font-weight="600">TimelineViewer</text>
  
  <rect x="515" y="450" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="580" y="475" text-anchor="middle" fill="white" font-size="10" font-weight="600">PerfettoExporter</text>
  
  <rect x="655" y="450" width="130" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="720" y="475" text-anchor="middle" fill="white" font-size="10" font-weight="600">ProtoExporter</text>

  <!-- Replay Module -->
  <rect x="820" y="310" width="260" height="200" rx="10" fill="url(#replayGrad)" filter="url(#lightShadow)"/>
  <text x="950" y="335" text-anchor="middle" fill="white" font-size="14" font-weight="700">Replay Module</text>
  
  <rect x="835" y="350" width="110" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="890" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">ReplayEngine</text>
  
  <rect x="955" y="350" width="110" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="1010" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">StreamScheduler</text>
  
  <rect x="835" y="400" width="110" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="890" y="425" text-anchor="middle" fill="white" font-size="10" font-weight="600">OpExecutor</text>
  
  <rect x="955" y="400" width="110" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="1010" y="425" text-anchor="middle" fill="white" font-size="10" font-weight="600">DeterminismChk</text>
  
  <rect x="835" y="450" width="230" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="950" y="475" text-anchor="middle" fill="white" font-size="10" font-weight="600">FrameCapture (RenderDoc-style)</text>

  <!-- GDB Module -->
  <rect x="1100" y="310" width="240" height="200" rx="10" fill="url(#gdbGrad)" filter="url(#lightShadow)"/>
  <text x="1220" y="335" text-anchor="middle" fill="white" font-size="14" font-weight="700">GDB Module (v0.10)</text>
  
  <rect x="1115" y="350" width="100" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="1165" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">RSPHandler</text>
  
  <rect x="1225" y="350" width="100" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="1275" y="375" text-anchor="middle" fill="white" font-size="10" font-weight="600">ProcessCtrl</text>
  
  <rect x="1115" y="400" width="210" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="1220" y="425" text-anchor="middle" fill="white" font-size="10" font-weight="600">GPUDebugEngine</text>
  
  <rect x="1115" y="450" width="210" height="40" rx="5" fill="rgba(0,0,0,0.15)"/>
  <text x="1220" y="475" text-anchor="middle" fill="white" font-size="10" font-weight="500">tracesmith-gdbserver</text>

  <!-- Row 2: Common + Format + Cluster -->
  
  <!-- Common Module -->
  <rect x="60" y="530" width="450" height="140" rx="10" fill="url(#commonGrad)" filter="url(#lightShadow)"/>
  <text x="285" y="555" text-anchor="middle" fill="white" font-size="14" font-weight="700">Common Module</text>
  
  <rect x="75" y="570" width="100" height="40" rx="5" fill="rgba(255,255,255,0.3)"/>
  <text x="125" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">Types</text>
  
  <rect x="185" y="570" width="100" height="40" rx="5" fill="rgba(255,255,255,0.3)"/>
  <text x="235" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">RingBuffer</text>
  
  <rect x="295" y="570" width="100" height="40" rx="5" fill="rgba(255,255,255,0.3)"/>
  <text x="345" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">StackCapture</text>
  
  <rect x="405" y="570" width="90" height="40" rx="5" fill="rgba(255,255,255,0.3)"/>
  <text x="450" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">XRayImport</text>
  
  <rect x="75" y="620" width="420" height="35" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="285" y="643" text-anchor="middle" fill="white" font-size="10" font-weight="500">TraceEvent | DeviceInfo | KernelParams | CallStack | MemoryEvent</text>

  <!-- Format Module -->
  <rect x="530" y="530" width="250" height="140" rx="10" fill="url(#formatGrad)" filter="url(#lightShadow)"/>
  <text x="655" y="555" text-anchor="middle" fill="white" font-size="14" font-weight="700">Format Module</text>
  
  <rect x="545" y="570" width="100" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="595" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">SBTWriter</text>
  
  <rect x="655" y="570" width="100" height="40" rx="5" fill="rgba(255,255,255,0.25)"/>
  <text x="705" y="595" text-anchor="middle" fill="white" font-size="10" font-weight="600">SBTReader</text>
  
  <rect x="545" y="620" width="210" height="35" rx="5" fill="rgba(0,0,0,0.15)"/>
  <text x="650" y="643" text-anchor="middle" fill="white" font-size="10" font-weight="500">.sbt Binary Format</text>

  <!-- Cluster Module -->
  <rect x="800" y="530" width="540" height="140" rx="10" fill="url(#clusterGrad)" filter="url(#lightShadow)"/>
  <text x="1070" y="555" text-anchor="middle" fill="#c92a2a" font-size="14" font-weight="700">Cluster Module (v0.8.x)</text>
  
  <rect x="815" y="570" width="120" height="40" rx="5" fill="rgba(255,255,255,0.5)"/>
  <text x="875" y="595" text-anchor="middle" fill="#c92a2a" font-size="10" font-weight="600">GPUTopology</text>
  
  <rect x="945" y="570" width="120" height="40" rx="5" fill="rgba(255,255,255,0.5)"/>
  <text x="1005" y="595" text-anchor="middle" fill="#c92a2a" font-size="10" font-weight="600">MultiGPUProfiler</text>
  
  <rect x="1075" y="570" width="120" height="40" rx="5" fill="rgba(255,255,255,0.5)"/>
  <text x="1135" y="595" text-anchor="middle" fill="#c92a2a" font-size="10" font-weight="600">TimeSync</text>
  
  <rect x="1205" y="570" width="120" height="40" rx="5" fill="rgba(255,255,255,0.5)"/>
  <text x="1265" y="595" text-anchor="middle" fill="#c92a2a" font-size="10" font-weight="600">NCCLTracker</text>
  
  <rect x="815" y="620" width="510" height="35" rx="5" fill="rgba(255,255,255,0.4)"/>
  <text x="1070" y="643" text-anchor="middle" fill="#c92a2a" font-size="10" font-weight="500">NVLink | PCIe | NVML | NTP/PTP | ClockCorrelator | CommAnalysis</text>

  <!-- Config Box -->
  <rect x="60" y="690" width="1280" height="60" rx="8" fill="#f1f3f5" stroke="#ced4da" stroke-width="1"/>
  <text x="80" y="715" fill="#495057" font-size="12" font-weight="600">Configuration</text>
  <rect x="200" y="698" width="140" height="35" rx="5" fill="#e9ecef"/>
  <text x="270" y="720" text-anchor="middle" fill="#495057" font-size="10">ProfilerConfig</text>
  <rect x="360" y="698" width="140" height="35" rx="5" fill="#e9ecef"/>
  <text x="430" y="720" text-anchor="middle" fill="#495057" font-size="10">ReplayConfig</text>
  <rect x="520" y="698" width="140" height="35" rx="5" fill="#e9ecef"/>
  <text x="590" y="720" text-anchor="middle" fill="#495057" font-size="10">StackCaptureConfig</text>
  <rect x="680" y="698" width="140" height="35" rx="5" fill="#e9ecef"/>
  <text x="750" y="720" text-anchor="middle" fill="#495057" font-size="10">NCCLTrackerConfig</text>
  <rect x="840" y="698" width="140" height="35" rx="5" fill="#e9ecef"/>
  <text x="910" y="720" text-anchor="middle" fill="#495057" font-size="10">GDBDebugConfig</text>

  <!-- Backend Layer -->
  <rect x="40" y="860" width="1320" height="90" rx="12" fill="#212529" filter="url(#shadow)"/>
  <text x="60" y="885" fill="#adb5bd" font-size="13" font-weight="600">GPU Backends &amp; System Layer</text>
  
  <rect x="60" y="900" width="120" height="38" rx="6" fill="#76b947"/>
  <text x="120" y="923" text-anchor="middle" fill="white" font-size="11" font-weight="600">CUDA/CUPTI</text>
  
  <rect x="195" y="900" width="120" height="38" rx="6" fill="#00bfff"/>
  <text x="255" y="923" text-anchor="middle" fill="white" font-size="11" font-weight="600">MACA/MCPTI</text>
  
  <rect x="330" y="900" width="100" height="38" rx="6" fill="#868e96"/>
  <text x="380" y="923" text-anchor="middle" fill="white" font-size="11" font-weight="600">Metal API</text>
  
  <rect x="445" y="900" width="110" height="38" rx="6" fill="#ff6b6b"/>
  <text x="500" y="923" text-anchor="middle" fill="white" font-size="11" font-weight="600">Ascend/CANN</text>
  
  <rect x="570" y="900" width="80" height="38" rx="6" fill="#ff9900"/>
  <text x="610" y="923" text-anchor="middle" fill="white" font-size="11" font-weight="600">NCCL</text>
  
  <rect x="665" y="900" width="90" height="38" rx="6" fill="#76b947"/>
  <text x="710" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">nsys</text>
  
  <rect x="770" y="900" width="90" height="38" rx="6" fill="#00bfff"/>
  <text x="815" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">mcTracer</text>
  
  <rect x="875" y="900" width="80" height="38" rx="6" fill="#868e96"/>
  <text x="915" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">xctrace</text>
  
  <rect x="970" y="900" width="80" height="38" rx="6" fill="#ff6b6b"/>
  <text x="1010" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">msprof</text>
  
  <rect x="1065" y="900" width="90" height="38" rx="6" fill="#4dabf7"/>
  <text x="1110" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">libunwind</text>
  
  <rect x="1170" y="900" width="90" height="38" rx="6" fill="#e599f7"/>
  <text x="1215" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">Perfetto</text>
  
  <rect x="1275" y="900" width="70" height="38" rx="6" fill="#a18cd1"/>
  <text x="1310" y="923" text-anchor="middle" fill="white" font-size="10" font-weight="500">ptrace</text>

  <!-- Output Formats -->
  <rect x="40" y="960" width="1320" height="60" rx="10" fill="#e7f5ff" stroke="#74c0fc" stroke-width="2"/>
  <text x="60" y="985" fill="#1971c2" font-size="13" font-weight="600">Output Formats</text>
  
  <rect x="200" y="970" width="150" height="38" rx="6" fill="#fa5252" filter="url(#lightShadow)"/>
  <text x="275" y="994" text-anchor="middle" fill="white" font-size="11" font-weight="500">.sbt (Binary)</text>
  
  <rect x="370" y="970" width="150" height="38" rx="6" fill="#4dabf7" filter="url(#lightShadow)"/>
  <text x="445" y="994" text-anchor="middle" fill="white" font-size="11" font-weight="500">.json (Perfetto)</text>
  
  <rect x="540" y="970" width="150" height="38" rx="6" fill="#e599f7" filter="url(#lightShadow)"/>
  <text x="615" y="994" text-anchor="middle" fill="white" font-size="11" font-weight="500">.perfetto (Proto)</text>
  
  <rect x="710" y="970" width="130" height="38" rx="6" fill="#51cf66" filter="url(#lightShadow)"/>
  <text x="775" y="994" text-anchor="middle" fill="white" font-size="11" font-weight="500">.dot (Graph)</text>
  
  <rect x="860" y="970" width="150" height="38" rx="6" fill="#868e96" filter="url(#lightShadow)"/>
  <text x="935" y="994" text-anchor="middle" fill="white" font-size="11" font-weight="500">ASCII Timeline</text>
  
  <rect x="1030" y="970" width="150" height="38" rx="6" fill="#ffd43b" filter="url(#lightShadow)"/>
  <text x="1105" y="994" text-anchor="middle" fill="#495057" font-size="11" font-weight="500">Comm Matrix</text>

  <!-- Data Flow Arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#adb5bd"/>
    </marker>
  </defs>
  
  <!-- Arrow from Capture to State -->
  <path d="M 480 410 L 500 410" stroke="#adb5bd" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Arrow from State to Replay -->
  <path d="M 800 410 L 820 410" stroke="#adb5bd" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Arrow from Replay to GDB -->
  <path d="M 1080 410 L 1100 410" stroke="#adb5bd" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Footer -->
  <text x="1340" y="1080" text-anchor="end" fill="#868e96" font-size="10">
    TraceSmith v0.10.0 | C++17 | pybind11 | CUDA/MACA/Metal/Ascend | GDB RSP | Cross-Platform
  </text>
</svg>
